{"version":3,"file":"parcel.js","sources":["../../src/parcel.js"],"sourcesContent":["import * as Vue from \"vue\";\n\nconst lessThanVue3 = !Vue.version || /^[012]\\..+/.test(Vue.version);\n\nexport default {\n  props: {\n    config: [Object, Promise],\n    wrapWith: String,\n    wrapClass: String,\n    wrapStyle: Object,\n    mountParcel: Function,\n    parcelProps: Object,\n  },\n  render(h) {\n    // Vue 2 works differently than Vue 3\n    h = typeof h === \"function\" ? h : Vue.h || (Vue.default && Vue.default.h);\n\n    const containerTagName = this.wrapWith || \"div\";\n    const props = { ref: \"container\" };\n    if (this.wrapClass) {\n      props.class = this.wrapClass;\n    }\n    if (this.wrapStyle) {\n      props.style = this.wrapStyle;\n    }\n    return h(containerTagName, props);\n  },\n  data() {\n    return {\n      hasError: false,\n    };\n  },\n  methods: {\n    addThingToDo(action, thing) {\n      if (this.hasError && action !== \"unmount\") {\n        return;\n      }\n\n      this.nextThingToDo = (this.nextThingToDo || Promise.resolve())\n        .then((...args) => {\n          if (this.unmounted && action !== \"unmount\") {\n            return;\n          }\n\n          return thing.apply(this, args);\n        })\n        .catch((err) => {\n          this.nextThingToDo = Promise.resolve();\n          this.hasError = true;\n\n          if (err && err.message) {\n            err.message = `During '${action}', parcel threw an error: ${err.message}`;\n          }\n\n          this.$emit(\"parcelError\", err);\n\n          throw err;\n        });\n    },\n    singleSpaMount() {\n      this.parcel = this.mountParcel(this.config, this.getParcelProps());\n\n      return this.parcel.mountPromise.then(() => {\n        this.$emit(\"parcelMounted\");\n      });\n    },\n    singleSpaUnmount() {\n      if (this.parcel) {\n        return this.parcel.unmount();\n      }\n    },\n    singleSpaUpdate() {\n      if (this.parcel && this.parcel.update) {\n        return this.parcel.update(this.getParcelProps()).then(() => {\n          this.$emit(\"parcelUpdated\");\n        });\n      }\n    },\n    getParcelProps() {\n      return {\n        domElement: this.$refs.container,\n        ...(this.parcelProps || {}),\n      };\n    },\n  },\n  mounted() {\n    if (!this.config) {\n      throw Error(`single-spa-vue: <parcel> component requires a config prop.`);\n    }\n\n    if (!this.mountParcel) {\n      throw Error(\n        `single-spa-vue: <parcel> component requires a mountParcel prop`\n      );\n    }\n\n    if (this.config) {\n      this.addThingToDo(\"mount\", this.singleSpaMount);\n    }\n  },\n  [lessThanVue3 ? \"destroyed\" : \"unmounted\"]() {\n    this.addThingToDo(\"unmount\", this.singleSpaUnmount);\n  },\n  watch: {\n    parcelProps: {\n      handler(parcelProps) {\n        this.addThingToDo(\"update\", this.singleSpaUpdate);\n      },\n    },\n  },\n};\n"],"names":["lessThanVue3","Vue","test","props","config","Object","Promise","wrapWith","String","wrapClass","wrapStyle","mountParcel","Function","parcelProps","render","h","containerTagName","this","ref","style","data","hasError","methods","addThingToDo","action","thing","nextThingToDo","resolve","then","_this","unmounted","args","apply","err","message","$emit","singleSpaMount","parcel","getParcelProps","mountPromise","_this2","singleSpaUnmount","unmount","singleSpaUpdate","update","_this3","domElement","$refs","container","mounted","Error","handler"],"mappings":"oYAEA,IAAMA,GAAgBC,GAAe,aAAaC,KAAKD,SAGrDE,MAAO,CACLC,OAAQ,CAACC,OAAQC,SACjBC,SAAUC,OACVC,UAAWD,OACXE,UAAWL,OACXM,YAAaC,SACbC,YAAaR,QAEfS,gBAAOC,GAELA,EAAiB,mBAANA,EAAmBA,EAAId,GAAUA,GAAeA,EAAYc,MAEjEC,EAAmBC,KAAKV,UAAY,MACpCJ,EAAQ,CAAEe,IAAK,oBACjBD,KAAKR,YACPN,QAAcc,KAAKR,WAEjBQ,KAAKP,YACPP,EAAMgB,MAAQF,KAAKP,WAEdK,EAAEC,EAAkBb,IAE7BiB,sBACS,CACLC,UAAU,IAGdC,QAAS,CACPC,sBAAaC,EAAQC,cACfR,KAAKI,UAAuB,YAAXG,SAIhBE,eAAiBT,KAAKS,eAAiBpB,QAAQqB,WACjDC,MAAK,eACAC,EAAKC,WAAwB,YAAXN,8BADdO,2BAAAA,yBAKDN,EAAMO,MAAMH,EAAME,cAEpB,SAACE,SACNJ,EAAKH,cAAgBpB,QAAQqB,UAC7BE,EAAKR,UAAW,EAEZY,GAAOA,EAAIC,UACbD,EAAIC,0BAAqBV,uCAAmCS,EAAIC,UAGlEL,EAAKM,MAAM,cAAeF,GAEpBA,OAGZG,iDACOC,OAASpB,KAAKN,YAAYM,KAAKb,OAAQa,KAAKqB,kBAE1CrB,KAAKoB,OAAOE,aAAaX,MAAK,WACnCY,EAAKL,MAAM,qBAGfM,+BACMxB,KAAKoB,cACApB,KAAKoB,OAAOK,WAGvBC,yCACM1B,KAAKoB,QAAUpB,KAAKoB,OAAOO,cACtB3B,KAAKoB,OAAOO,OAAO3B,KAAKqB,kBAAkBV,MAAK,WACpDiB,EAAKV,MAAM,qBAIjBG,kYAEIQ,WAAY7B,KAAK8B,MAAMC,WACnB/B,KAAKJ,aAAe,MAI9BoC,uBACOhC,KAAKb,aACF8C,wEAGHjC,KAAKN,kBACFuC,wEAKJjC,KAAKb,aACFmB,aAAa,QAASN,KAAKmB,sBAGnCpC,EAAe,YAAc,6BACvBuB,aAAa,UAAWN,KAAKwB,iCAE7B,CACL5B,YAAa,CACXsC,iBAAQtC,QACDU,aAAa,SAAUN,KAAK0B"}